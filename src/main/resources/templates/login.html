<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - 커휫</title>
    <link th:href="@{/css/common.css}" rel="stylesheet">
    <link th:href="@{/css/login.css}" rel="stylesheet">
</head>
<body>
    <div class="login-container">
        <!-- 왼쪽: 서비스 소개 -->
        <div class="intro-section">
            <div class="intro-content">
                <div class="logo-section">
                    <div class="logo-icon">💬</div>
                    <h1 class="logo-text">커휫</h1>
                </div>
                
                <div class="intro-text">
                    <h2>GitHub 커밋을<br>스마트하게 요약해드립니다</h2>
                    <p class="description">
                        whisper 커밋을 자동으로 감지하고<br>
                        AI가 변경사항을 분석하여<br>
                        팀원들에게 공유하기 쉬운 요약을 제공합니다.
                    </p>
                    <div class="features">
                        <div class="feature-item">
                            <span class="feature-icon">✨</span>
                            <span>자동 커밋 감지</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">🤖</span>
                            <span>AI 기반 요약</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">📊</span>
                            <span>히스토리 관리</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 오른쪽: 로그인/회원가입 폼 -->
        <div class="login-section">
            <div class="form-card">
                <!-- 로그인 폼 -->
                <div id="loginForm" class="form-view active">
                    <h2 class="login-title">로그인</h2>
                    
                    <div id="loginErrorMessage" class="error-message" style="display: none;"></div>
                    <div th:if="${error}" class="error-message" th:text="${error}"></div>
                    <div th:if="${message}" class="message" th:text="${message}"></div>
                    
                    <form th:action="@{/login}" th:object="${loginReq}" method="post" class="login-form">
                        <div class="form-group">
                            <label for="loginId">아이디</label>
                            <input type="text" id="loginId" th:field="*{loginId}" placeholder="아이디를 입력하세요" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">비밀번호</label>
                            <input type="password" id="password" th:field="*{password}" placeholder="비밀번호를 입력하세요" required>
                        </div>
                        
                        <button type="submit" class="btn-primary">로그인</button>
                    </form>
                    
                    <div class="oauth-divider">
                        <span>또는</span>
                    </div>
                    
                    <a th:href="@{/oauth2/authorization/google}" class="btn-oauth">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                        Google로 로그인
                    </a>
                    
                    <a th:href="@{/oauth2/authorization/github}" class="btn-oauth" style="background: #24292e; color: white; border-color: #24292e;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        GitHub로 로그인
                    </a>
                    
                    <div class="signup-link">
                        <span>계정이 없으신가요?</span>
                        <a href="#" id="switchToSignup" class="link">회원가입</a>
                    </div>
                </div>

                <!-- 회원가입 폼 -->
                <div id="signupForm" class="form-view">
                    <h2 class="login-title">회원가입</h2>
                    
                    <div id="signupErrorMessage" class="error-message" style="display: none;"></div>
                    
                    <form id="signupFormElement" class="login-form">
                        <div class="form-group">
                            <label for="signupLoginId">아이디</label>
                            <input type="text" id="signupLoginId" placeholder="아이디를 입력하세요" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupPassword">비밀번호</label>
                            <input type="password" id="signupPassword" placeholder="비밀번호를 입력하세요" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupName">이름</label>
                            <input type="text" id="signupName" placeholder="이름을 입력하세요" required>
                        </div>
                        
                        <button type="submit" class="btn-primary">회원가입</button>
                    </form>
                    
                    <div class="signup-link">
                        <span>이미 계정이 있으신가요?</span>
                        <a href="#" id="switchToLogin" class="link">로그인</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 폼 전환 기능
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const switchToSignup = document.getElementById('switchToSignup');
        const switchToLogin = document.getElementById('switchToLogin');

        switchToSignup.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.classList.remove('active');
            signupForm.classList.add('active');
        });

        switchToLogin.addEventListener('click', function(e) {
            e.preventDefault();
            signupForm.classList.remove('active');
            loginForm.classList.add('active');
        });

        // 회원가입 폼 제출
        document.getElementById('signupFormElement').addEventListener('submit', function(e) {
            e.preventDefault();

            const signupData = {
                loginId: document.getElementById('signupLoginId').value,
                password: document.getElementById('signupPassword').value,
                name: document.getElementById('signupName').value
            };

            const errorDiv = document.getElementById('signupErrorMessage');
            errorDiv.style.display = 'none';

            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = '처리 중...';

            fetch('/api/v1/users/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(signupData)
            })
            .then(response => {
                if (response.ok) {
                    // 회원가입 성공 시 로그인 폼으로 전환하고 메시지 표시
                    signupForm.classList.remove('active');
                    loginForm.classList.add('active');
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message';
                    messageDiv.textContent = '회원가입이 완료되었습니다. 로그인해주세요.';
                    loginForm.insertBefore(messageDiv, loginForm.querySelector('.login-form'));
                    setTimeout(() => {
                        messageDiv.remove();
                    }, 5000);
                } else {
                    return response.json().then(data => {
                        throw new Error(data.message || '회원가입 중 오류가 발생했습니다.');
                    }).catch(err => {
                        if (err.message) {
                            throw err;
                        }
                        return response.text().then(text => {
                            throw new Error(text || '회원가입 중 오류가 발생했습니다.');
                        });
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                errorDiv.textContent = error.message || '회원가입 중 오류가 발생했습니다.';
                errorDiv.style.display = 'block';
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            });
        });
    </script>
</body>
</html>
