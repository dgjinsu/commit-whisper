<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - 커휫</title>
    <link th:href="@{/css/login.css}" rel="stylesheet">
</head>
<body>
    <div class="login-container">
        <!-- 왼쪽: 서비스 소개 -->
        <div class="intro-section">
            <div class="intro-content">
                <div class="logo-section">
                    <div class="logo-icon">💬</div>
                    <h1 class="logo-text">커휫</h1>
                </div>
                
                <div class="intro-text">
                    <h2>GitHub 커밋을<br>스마트하게 요약해드립니다</h2>
                    <p class="description">
                        whisper 커밋을 자동으로 감지하고<br>
                        AI가 변경사항을 분석하여<br>
                        팀원들에게 공유하기 쉬운 요약을 제공합니다.
                    </p>
                    <div class="features">
                        <div class="feature-item">
                            <span class="feature-icon">✨</span>
                            <span>자동 커밋 감지</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">🤖</span>
                            <span>AI 기반 요약</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">📊</span>
                            <span>히스토리 관리</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 오른쪽: 로그인/회원가입 폼 -->
        <div class="login-section">
            <div class="form-card">
                <!-- 로그인 폼 -->
                <div id="loginForm" class="form-view active">
                    <h2 class="login-title">로그인</h2>
                    
                    <div id="loginErrorMessage" class="error-message" style="display: none;"></div>
                    <div th:if="${error}" class="error-message" th:text="${error}"></div>
                    <div th:if="${message}" class="message" th:text="${message}"></div>
                    
                    <form th:action="@{/login}" th:object="${loginReq}" method="post" class="login-form">
                        <div class="form-group">
                            <label for="loginId">아이디</label>
                            <input type="text" id="loginId" th:field="*{loginId}" placeholder="아이디를 입력하세요" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">비밀번호</label>
                            <input type="password" id="password" th:field="*{password}" placeholder="비밀번호를 입력하세요" required>
                        </div>
                        
                        <button type="submit" class="btn-primary">로그인</button>
                    </form>
                    
                    <div class="signup-link">
                        <span>계정이 없으신가요?</span>
                        <a href="#" id="switchToSignup" class="link">회원가입</a>
                    </div>
                </div>

                <!-- 회원가입 폼 -->
                <div id="signupForm" class="form-view">
                    <h2 class="login-title">회원가입</h2>
                    
                    <div id="signupErrorMessage" class="error-message" style="display: none;"></div>
                    
                    <form id="signupFormElement" class="login-form">
                        <div class="form-group">
                            <label for="signupLoginId">아이디</label>
                            <input type="text" id="signupLoginId" placeholder="아이디를 입력하세요" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupPassword">비밀번호</label>
                            <input type="password" id="signupPassword" placeholder="비밀번호를 입력하세요" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupName">이름</label>
                            <input type="text" id="signupName" placeholder="이름을 입력하세요" required>
                        </div>
                        
                        <button type="submit" class="btn-primary">회원가입</button>
                    </form>
                    
                    <div class="signup-link">
                        <span>이미 계정이 있으신가요?</span>
                        <a href="#" id="switchToLogin" class="link">로그인</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 폼 전환 기능
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const switchToSignup = document.getElementById('switchToSignup');
        const switchToLogin = document.getElementById('switchToLogin');

        switchToSignup.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.classList.remove('active');
            signupForm.classList.add('active');
        });

        switchToLogin.addEventListener('click', function(e) {
            e.preventDefault();
            signupForm.classList.remove('active');
            loginForm.classList.add('active');
        });

        // 회원가입 폼 제출
        document.getElementById('signupFormElement').addEventListener('submit', function(e) {
            e.preventDefault();

            const signupData = {
                loginId: document.getElementById('signupLoginId').value,
                password: document.getElementById('signupPassword').value,
                name: document.getElementById('signupName').value
            };

            const errorDiv = document.getElementById('signupErrorMessage');
            errorDiv.style.display = 'none';

            fetch('/api/v1/users/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(signupData)
            })
            .then(response => {
                if (response.ok) {
                    // 회원가입 성공 시 로그인 폼으로 전환하고 메시지 표시
                    signupForm.classList.remove('active');
                    loginForm.classList.add('active');
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message';
                    messageDiv.textContent = '회원가입이 완료되었습니다. 로그인해주세요.';
                    loginForm.insertBefore(messageDiv, loginForm.querySelector('.login-form'));
                    setTimeout(() => {
                        messageDiv.remove();
                    }, 5000);
                } else {
                    response.text().then(text => {
                        errorDiv.textContent = text || '회원가입 중 오류가 발생했습니다.';
                        errorDiv.style.display = 'block';
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                errorDiv.textContent = '회원가입 중 오류가 발생했습니다.';
                errorDiv.style.display = 'block';
            });
        });
    </script>
</body>
</html>
