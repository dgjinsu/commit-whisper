<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μ»¤ν« - μ»¤λ°‹ μ”μ•½ μ΄λ ¥</title>
    <link th:href="@{/css/common.css}" rel="stylesheet">
    <link th:href="@{/css/home.css}" rel="stylesheet">
    <link th:href="@{/css/history.css}" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <div th:replace="~{fragments/header :: header(user=${user})}"></div>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1>μ»¤λ°‹ μ”μ•½ μ΄λ ¥</h1>
            <p class="page-description">LLMμΌλ΅ μƒμ„±λ μ»¤λ°‹ μ”μ•½ μ΄λ ¥μ„ ν™•μΈν•μ„Έμ”</p>
        </div>

        <!-- Stats -->
        <div class="history-stats">
            <span class="stat-label">μ΄ μ΄λ ¥</span>
            <span class="stat-value" th:text="${historyCount} + 'κ°'">0κ°</span>
        </div>

        <!-- History List -->
        <div class="history-list-section">
            <div th:if="${histories != null && !histories.isEmpty()}" class="history-list">
                <a th:each="history : ${histories}" th:href="@{/history/{id}(id=${history.id()})}" class="history-card" style="text-decoration: none; display: block; color: inherit;">
                    <div class="history-card-header">
                        <div class="history-repo-info">
                            <div class="repo-badge">
                                <span class="repo-icon">π“</span>
                                <span class="repo-name" th:text="${history.repoOwner() + '/' + history.repoName()}"></span>
                            </div>
                            <div class="commit-sha" th:text="'SHA: ' + ${history.commitSha().substring(0, 7)}"></div>
                        </div>
                        <div class="history-date">
                            <span class="date-label">μ”μ•½ μƒμ„±μΌ</span>
                            <span class="date-value" th:text="${#temporals.format(history.createdAt(), 'yyyy-MM-dd HH:mm')}"></span>
                        </div>
                    </div>
                    
                    <div class="history-card-body">
                        <div class="summary-content" th:utext="${#strings.abbreviate(history.htmlSummary(), 200)}"></div>
                    </div>
                    
                    <div class="history-card-footer">
                        <div class="commit-date-info">
                            <span class="commit-date-label">μ»¤λ°‹ λ‚ μ§</span>
                            <span class="commit-date-value" th:text="${#temporals.format(history.commitDate(), 'yyyy-MM-dd HH:mm')}"></span>
                        </div>
                    </div>
                </a>
            </div>
            
            <div th:if="${histories == null || histories.isEmpty()}" class="empty-state">
                <div class="empty-icon">π“</div>
                <p class="empty-text">μ•„μ§ μƒμ„±λ μ»¤λ°‹ μ”μ•½μ΄ μ—†μµλ‹λ‹¤.</p>
                <p class="empty-hint">whisper μ»¤λ°‹μ΄ κ°μ§€λλ©΄ μλ™μΌλ΅ μ”μ•½μ΄ μƒμ„±λ©λ‹λ‹¤.</p>
            </div>
        </div>

        <!-- Pagination -->
        <div th:if="${histories != null && !histories.isEmpty() && totalPages > 1}" class="pagination-container">
            <div class="pagination-info">
                <span>μ΄ <strong th:text="${totalElements}">0</strong>κ° μ¤‘ 
                    <strong th:text="${currentPage * pageSize + 1}">1</strong> - 
                    <strong th:text="${currentPage * pageSize + histories.size()}">10</strong>κ° ν‘μ‹</span>
            </div>
            <div class="pagination">
                <a th:href="@{/history(page=${currentPage - 1}, size=${pageSize})}" 
                   th:if="${hasPrevious}" 
                   class="pagination-btn" 
                   title="μ΄μ „ νμ΄μ§€">β€Ή</a>
                <span th:if="${!hasPrevious}" class="pagination-btn disabled" title="μ΄μ „ νμ΄μ§€">β€Ή</span>
                
                <th:block th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
                    <th:block th:if="${pageNum == 0 || pageNum == totalPages - 1 || (pageNum >= currentPage - 2 && pageNum <= currentPage + 2)}">
                        <a th:href="@{/history(page=${pageNum}, size=${pageSize})}" 
                           th:text="${pageNum + 1}"
                           th:class="${pageNum == currentPage} ? 'pagination-btn active' : 'pagination-btn'"></a>
                    </th:block>
                    <th:block th:if="${pageNum > 0 && pageNum < totalPages - 1 && pageNum == currentPage - 3 && currentPage > 3}">
                        <span class="pagination-ellipsis">...</span>
                    </th:block>
                    <th:block th:if="${pageNum > 0 && pageNum < totalPages - 1 && pageNum == currentPage + 3 && currentPage < totalPages - 4}">
                        <span class="pagination-ellipsis">...</span>
                    </th:block>
                </th:block>
                
                <a th:href="@{/history(page=${currentPage + 1}, size=${pageSize})}" 
                   th:if="${hasNext}" 
                   class="pagination-btn" 
                   title="λ‹¤μ νμ΄μ§€">β€Ί</a>
                <span th:if="${!hasNext}" class="pagination-btn disabled" title="λ‹¤μ νμ΄μ§€">β€Ί</span>
            </div>
        </div>
    </div>

    <!-- Header Script -->
    <div th:replace="~{fragments/header :: headerScript}"></div>
</body>
</html>

